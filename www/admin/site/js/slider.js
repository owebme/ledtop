$(function(){

	var last_referrer = document.referrer;

	if (last_referrer.match(/boss-royal-viagra/)){
		createSlider("boss-royal-viagra", "<span>«Boss Royal™</span><br><em>Viagra»</em>", "При создании препарата была использована<br> технология экстрагирования, <em>которая является<br> новым словом в решении проблемы<br> импотенции.</em>", 3);
	}		
	else if (last_referrer.match(/shpanskaya-mushka/)){
		createSlider("shpanskaya-mushka", "<span>«Шпанская &nbsp; &nbsp;</span><br><em>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;мушка»</em>", "Новый препарат для женщин, приготовленный на<br> основе известной \"Шпанской Мушки\", которой<br> <em>пользовались для возбуждения как мужчин,<br> так и женщин еще в Древней Греции.</em>", 3);
	}
	else if (last_referrer.match(/satibo/)){
		createSlider("satibo", "<span>«Сатибо &nbsp; &nbsp; &nbsp; &nbsp;</span><br><em>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Satibo»</em>", "Полностью состоящий из натуральных растительных компонентов<em>, выводит сексуальную жизнь на<br> новый уровень, усиливает чувственные<br> ощущения как у мужчин, так и у женщин,</em><br> способствует повышению либидо.", 3);
	}
	else if (last_referrer.match(/tverdyj-i-krepkij/)){
		createSlider("tverdyj-i-krepkij", "<span>«Твердый и&nbsp; &nbsp; </span><br><em>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;крепкий»</em>", "Вызывает силу, способствует увеличению и утолщению продлевает акт<em>, предотвращает преждевременное и повышает. Действие препарата длится до 72 часов<br> после приема.</em>", 3);
	}	
	else if (last_referrer.match(/stoit-10-dnej-podryad/)){
		createSlider("stoit-10-dnej-podryad", "<span>«Стоит 10 &nbsp;</span><br><em>&nbsp; &nbsp;дней подряд»</em>", "Препарат «Стоит 10 дней», выработан из пантов и<br> <em>пениса дикого оленя из горной провинции Юньгуй и<br> эндемических фруктов провинции Ямасунь.</em>", 3);
	}
	else if (last_referrer.match(/molodec/)){
		createSlider("molodec", "<span>«Молодец &nbsp; &nbsp; &nbsp;</span><br><em>&nbsp; &nbsp; &nbsp; &nbsp; Дингуагуа»</em>", "Максимальная стойкость эрекции и увеличение<br> объемов пениса за счет прилива крови.<br> <em>Дингуагуа разработан двумя компаниями в<br> области биоинженерии &ndash; американской и<br> китайской (Сижуй).</em>", 3);
	}	
	else if (last_referrer.match(/serebryanaya-lisa/)){
		createSlider("serebryanaya-lisa", "<span>«Серебряная</span> лиса»", "Из самых быстродействующих и эффективных<br> препаратов <em>для создания чувственной атмосферы,<br> пробуждения сексуального желания у женщин.</em>", 4);
	}
	else if (last_referrer.match(/yarsagumba-krasnaya/)){
		createSlider("yarsagumba-krasnaya", "<span>«Ярсагумба &nbsp; &nbsp;</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Красная»", "Препарат является на 100% натуральным. <em>Повышает потенцию, предотвращает<br> поллюции, вызывает усиление сексуального влечения.</em>", 5);
	}	
	else if (last_referrer.match(/yarsagumba/)){
		createSlider("yarsagumba", "<span>«Ярсагумба</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Yarsagumba»", "Препарат является на 100% натуральным.<br> Повышает потенцию, предотвращает поллюции,<br> <em>вызывает усиление сексуального влечения,<br> применим равно как для мужчин и женщин.</em>", 4);
	}	
	else if (last_referrer.match(/fuzhunbao-super/)){
		createSlider("fuzhunbao-super", "<span>«Фужуньбао</span> супер»", "Лекарственные растения, входящие в состав<br> добавки являются эфироносами и их эфирные<br> <em>масла обладают спазмолитическим и<br> противовоспалительным действием.</em>", 4);
	}
	else if (last_referrer.match(/sealeks-forte/)){
		createSlider("sealeks-forte", "<span>«Сеалекс</span> Форте»", "Новое средство для повышения потенции,<br> <em>усиления эрекции, решения проблем с<br> преждевременным семяизвержением.<br> Сеалекс не содержит хим компонентов.</em>", 4);
	}
	else if (last_referrer.match(/otvazhnyj-polkovodec/)){
		createSlider("otvazhnyj-polkovodec", "<span>«Отважный</span><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; полководец»", "Быстро обеспечивает стабильную и сильную эрекцию. <em>Эффективность этого препарата обусловлена его уникальным запатентованным составом.</em>", 4);
	}
	else if (last_referrer.match(/russkaya-moschnaya-viagra/)){
		createSlider("russkaya-moschnaya-viagra", "<span>&nbsp; &nbsp;«Русская мощная</span><br>&nbsp; &nbsp; &nbsp; виагра»", "Изготовленно специалистами нашей страны для наших же граждан, <em>который способствует притоку крови к органам малого таза и к половому члену в частности.</em>", 5);
	}
	else if (last_referrer.match(/udvoennyj-penis/)){
		createSlider("udvoennyj-penis", "<span>«Удвоенный</span><br>&nbsp; пенис»", "Препарат \"Удвоенный пенис\" способствует увеличению полового органа, а также <em>улучшению качества сексуальной жизни и повышению либидо.</em>", 5);
	}
	else if (last_referrer.match(/palochka-doyan-chka/)){
		createSlider("palochka-doyan-chka", "<span>«Палочка Чка</span><br>доянь»", "Палочка ЧКА Доянь за очень короткое время после применения <em>естественным путем сокращает мышцы и возвращает \"девственность\".</em>", 5);
	}	
	else {
		sliderStart();
	}
	
	function createSlider(alias, name, desc, slide){
		if (slide == 3){
			var price = $("#product_"+alias).find(".cost").html();
			if (parseInt(price) > 0){price = price+"<em>-</em>";} else {price = "Звоните";}
			var slide ='<div class="slide3 show" onclick="document.location=\'/products/all/'+alias+'\'">'
				+ '<div class="slide_text1" data-anim="animate1">'+name+'</div>'
				+ '<div class="slide_text2" data-anim="animate1"><span>'+desc+'</span></div>'
				+ '<div class="slide_text3" data-anim="animate2">Не экономьте<span>на подделках</span></div>'
				+ '<img class="slide_product '+alias+'" src="/img/slides/product_'+alias+'.png" alt="">'
				+ '<div class="slide_price" data-anim="animate2"><span>'+price+'</span></div>'
				+ '<img class="head" src="/img/slides/slide3_head.png" alt="">'
				+ '<img class="feet" src="/img/slides/slide3_feet.png" alt="">'
			+ '</div>';
			$("#slider").find(".slide3").remove();
			$("#slider").find(".slide4").remove();
			$("#slider").prepend(slide);
			sliderStart(3, "no-cashed");		
		}
		else if (slide == 4){
			var price = $("#product_"+alias).find(".cost").html();
			if (parseInt(price) > 0){price = price+"<em>-</em>";} else {price = "Звоните";}
			var slide ='<div class="slide4 show" onclick="document.location=\'/products/all/'+alias+'\'">'
				+ '<div class="slide_text1" data-anim="animate1">'+name+'</div>'
				+ '<div class="slide_text2" data-anim="animate1"><span>'+desc+'</span></div>'
				+ '<div class="slide_text3 hide" data-anim="animate2">Не забываемый<span>секс с любимой</span></div>'
				+ '<img class="slide_product '+alias+'" src="/img/slides/product_'+alias+'.png" alt="">'
				+ '<div class="slide_price" data-anim="animate2"><span>'+price+'</span></div>'
			+ '</div>';
			$("#slider").find(".slide3").remove();
			$("#slider").find(".slide4").remove();
			$("#slider").prepend(slide);
			sliderStart(4, "no-cashed");		
		}
		else if (slide == 5){
			var price = $("#product_"+alias).find(".cost").html();
			if (parseInt(price) > 0){price = price+"<em>-</em>";} else {price = "Звоните";}
			var slide ='<div class="slide5 show" onclick="document.location=\'/products/all/'+alias+'\'">'
				+ '<div class="slide_text1" data-anim="animate1">'+name+'</div>'
				+ '<div class="slide_text2" data-anim="animate1"><span>'+desc+'</span></div>'
				+ '<div class="slide_text3" data-anim="animate2">Получить новые<span>ощущения</span></div>'
				+ '<img class="slide_product '+alias+'" src="/img/slides/product_'+alias+'.png" alt="">'
				+ '<div class="slide_price" data-anim="animate2"><span>'+price+'</span></div>'
			+ '</div>';
			$("#slider").find(".slide3").remove();
			$("#slider").find(".slide4").remove();
			$("#slider").prepend(slide);
			sliderStart(5, "no-cashed");		
		}
	}
	
	function sliderStart(num, cash){
		if (num && cash == "no-cashed"){
			if (num == 3){slide3_anim();}
			else if (num == 4){slide4_anim();}
			else if (num == 5){slide5_anim();}	
		}
		else {
			var i=0; start = false;
			var cnt = $(".slide3").find("img.cashed").length;
			$(".slide3").find("img.cashed").each(function(){
				i++;
				var $img = $(this);
				$img.attr("src", $img.attr("src")+"?"+Math.random());
				$img.load(function(){
					if (i == cnt && !start){
						start = true;
						slide3_anim("first");
					}
				});
			});
		}
	}
	
	$("#slider").css("opacity", "1");
	
	function slide1_anim(next){
		var speed = 0;
		if (next){speed = 100}
		$(".slide1_text1").attr("class", "slide1_text1 "+$(".slide1_text1").attr("data-anim"));
		$(".slide1_text2").attr("class", "slide1_text2 "+$(".slide1_text2").attr("data-anim"));
		$(".slide1_text3").attr("class", "slide1_text3 "+$(".slide1_text3").attr("data-anim"));
		$(".slide1_price").attr("class", "slide1_price "+$(".slide1_price").attr("data-anim"));
		$(".slide1_point").attr("class", "slide1_point "+$(".slide1_point").attr("data-anim"));
		$(".slide1_stamp").attr("class", "slide1_stamp "+$(".slide1_stamp").attr("data-anim"));
		setTimeout(function(){
			$(".slide1_text1").addClass("anim").addClass("bounceIn");
			setTimeout(function(){
				$(".slide1_text2").addClass("anim").addClass("bounceInLeft");
				setTimeout(function(){
					$(".slide1_price").addClass("anim").addClass("lightSpeedIn");
					setTimeout(function(){
						$(".slide1_point").addClass("anim").addClass("bounceIn");
						setTimeout(function(){
							$(".slide1_text3").addClass("anim").addClass("lightSpeedIn");
							setTimeout(function(){
								$(".slide1_stamp").addClass("anim").addClass("bounceIn");
								setTimeout(function(){
									setTimeout(function(){
										$(".slide2").css("left", "960px");
										$(".slide1").animate({"left": "-960px"}, 500, "easeOutQuint");
										$(".slide2").animate({"left": "0px"}, 500, "easeOutQuint");
										$(".blocks-info").find(".delivery").find("em").fadeOut(500, "easeOutQuint");
									}, 100);
									setTimeout(function(){
										slide2_anim("next");
									}, 200);
								}, 5000);
							}, 200);
						}, 500);					
					}, 400);
				}, 800);
			}, 500);
		}, speed);
	}	
	
	function slide2_anim(next){
		var speed = 0;
		if (next){speed = 100}
		$(".slide2_text1").attr("class", "slide2_text1 "+$(".slide2_text1").attr("data-anim"));
		$(".slide2_text2").attr("class", "slide2_text2 "+$(".slide2_text2").attr("data-anim"));
		$(".slide2_price").attr("class", "slide2_price "+$(".slide2_price").attr("data-anim"));
		$(".slide2_point").attr("class", "slide2_point "+$(".slide2_point").attr("data-anim"));
		setTimeout(function(){
			$(".slide2_text1").addClass("anim").addClass("bounceIn");
			setTimeout(function(){
				$(".slide2_price").addClass("anim").addClass("lightSpeedIn");
				setTimeout(function(){
					$(".slide2_point").addClass("anim").addClass("bounceIn");
					setTimeout(function(){
						$(".slide2_text2").addClass("bounceInDown").addClass("anim");
						setTimeout(function(){
							setTimeout(function(){
								$(".slide2_text2").removeClass("bounceInDown").addClass("rubberBand");
							}, 600);
							setTimeout(function(){
								var $first = $("#slider").children(":first");
								setTimeout(function(){
									$first.css("left", "960px");
									$(".slide2").animate({"left": "-960px"}, 500, "easeOutQuint");
									$first.animate({"left": "0px"}, 500, "easeOutQuint");
									$(".blocks-info").find(".delivery").find("em").fadeIn(500, "easeOutQuint");									
								}, 100);
								setTimeout(function(){
									if ($first.attr("class").match(/slide3/)){
										slide3_anim("next");
									}
									else if ($first.attr("class").match(/slide4/)){
										slide4_anim("next");
									}
									else if ($first.attr("class").match(/slide5/)){
										slide5_anim("next");
									}									
								}, 200);
							}, 5600);
						}, 200);
					}, 600);
				}, 400);
			}, 600);
		}, speed);
	}
	
	function slide3_anim(next){
		var speed = 0;
		if (next == "next"){speed = 100}
		var $slide3 = $(".slide3");
		if (!next){
			$slide3.find(".slide_text3").addClass("hide");
			var $div = $slide3.find(".hide");
			setTimeout(function(){
				$div.attr("class", "slide_text3 "+$div.attr("data-anim"));
				$div.addClass("bounceInDown").addClass("anim");
				setTimeout(function(){
					$div.removeClass("bounceInDown").addClass("rubberBand");
					setTimeout(function(){
						setTimeout(function(){
							$(".slide1").css("left", "960px");
							$(".slide3").animate({"left": "-960px"}, 500, "easeOutQuint");
							$(".slide1").animate({"left": "0px"}, 500, "easeOutQuint");
						}, 100);
						setTimeout(function(){
							slide1_anim("next");
						}, 200);
					}, 7000);
				}, 800);
			}, 500);
		}
		else {
			$slide3.removeClass("show");
			$slide3.find(".slide_text1").attr("class", "slide_text1 "+$slide3.find(".slide_text1").attr("data-anim"));
			$slide3.find(".slide_text2").attr("class", "slide_text2 "+$slide3.find(".slide_text2").attr("data-anim"));
			$slide3.find(".slide_text3").attr("class", "slide_text3 "+$slide3.find(".slide_text3").attr("data-anim"));
			$slide3.find(".slide_price").attr("class", "slide_price "+$slide3.find(".slide_price").attr("data-anim"));
			setTimeout(function(){
				$slide3.find(".slide_text1").addClass("anim").addClass("bounceIn");
				setTimeout(function(){
					$slide3.find(".slide_text2").addClass("anim").addClass("bounceInLeft");
					setTimeout(function(){
						$slide3.find(".slide_price").addClass("anim").addClass("lightSpeedIn");
						setTimeout(function(){
							$slide3.find(".slide_text3").addClass("bounceInDown").addClass("anim");
							setTimeout(function(){
								$slide3.find(".slide_text3").removeClass("bounceInDown").addClass("rubberBand");
								setTimeout(function(){
									var $next = $(".slide3").next();
									setTimeout(function(){
										$next.css("left", "960px");
										$(".slide3").animate({"left": "-960px"}, 500, "easeOutQuint");
										$next.animate({"left": "0px"}, 500, "easeOutQuint");
									}, 100);
									setTimeout(function(){
										if ($next.attr("class").match(/slide1/)){
											slide1_anim("next");
										}
										else if ($next.attr("class").match(/slide4/)){
											slide4_anim("next");
										}									
									}, 200);
								}, 5600);
							}, 800);
						}, 500);					
					}, 800);
				}, 500);
			}, 0);
		}
	}	
	
	function slide4_anim(next){
		var speed = 0;
		if (next){speed = 100}
		var $slide4 = $(".slide4");
		if (!next){
			$slide4.find(".slide_text3").addClass("hide");
			var $div = $slide4.find(".hide");
			setTimeout(function(){
				$div.attr("class", "slide_text3 "+$div.attr("data-anim"));
				$div.addClass("lightSpeedIn").addClass("anim");
				setTimeout(function(){
					$div.removeClass("lightSpeedIn").addClass("rubberBand");
					setTimeout(function(){
						setTimeout(function(){
							$(".slide1").css("left", "960px");
							$(".slide4").animate({"left": "-960px"}, 500, "easeOutQuint");
							$(".slide1").animate({"left": "0px"}, 500, "easeOutQuint");
						}, 100);
						setTimeout(function(){
							slide1_anim("next");
						}, 200);
					}, 7000);
				}, 800);
			}, 500);
		}
		else {
			$slide4.removeClass("show");
			$slide4.find(".slide_text1").attr("class", "slide_text1 "+$slide4.find(".slide_text1").attr("data-anim"));
			$slide4.find(".slide_text2").attr("class", "slide_text2 "+$slide4.find(".slide_text2").attr("data-anim"));
			$slide4.find(".slide_text3").attr("class", "slide_text3 "+$slide4.find(".slide_text3").attr("data-anim"));
			$slide4.find(".slide_price").attr("class", "slide_price "+$slide4.find(".slide_price").attr("data-anim"));
			setTimeout(function(){
				$slide4.find(".slide_text1").addClass("anim").addClass("bounceInLeft");
				setTimeout(function(){
					$slide4.find(".slide_text2").addClass("anim").addClass("bounceInLeft");
					setTimeout(function(){
						$slide4.find(".slide_price").addClass("anim").addClass("lightSpeedIn");
						setTimeout(function(){
							$slide4.find(".slide_text3").addClass("anim").addClass("bounceIn");
							setTimeout(function(){
								setTimeout(function(){
									$(".slide1").css("left", "960px");
									$(".slide4").animate({"left": "-960px"}, 500, "easeOutQuint");
									$(".slide1").animate({"left": "0px"}, 500, "easeOutQuint");
								}, 100);
								setTimeout(function(){
									slide1_anim("next");
								}, 200);
							}, 5000);
						}, 500);					
					}, 800);
				}, 500);
			}, speed);
		}
	}
	
	function slide5_anim(next){
		var speed = 0;
		if (next == "next"){speed = 100}
		var $slide5 = $(".slide5");
		if (!next){
			$slide5.find(".slide_text3").addClass("hide");
			var $div = $slide5.find(".hide");
			setTimeout(function(){
				$div.attr("class", "slide_text3 "+$div.attr("data-anim"));
				$div.addClass("anim").addClass("bounceIn");
				setTimeout(function(){
					$div.removeClass("bounceIn").addClass("rubberBand");
					setTimeout(function(){
						setTimeout(function(){
							$(".slide1").css("left", "960px");
							$(".slide5").animate({"left": "-960px"}, 500, "easeOutQuint");
							$(".slide1").animate({"left": "0px"}, 500, "easeOutQuint");
						}, 100);
						setTimeout(function(){
							slide1_anim("next");
						}, 200);
					}, 7000);
				}, 800);
			}, 500);
		}
		else {
			$slide5.removeClass("show");
			$slide5.find(".slide_text1").attr("class", "slide_text1 "+$slide5.find(".slide_text1").attr("data-anim"));
			$slide5.find(".slide_text2").attr("class", "slide_text2 "+$slide5.find(".slide_text2").attr("data-anim"));
			$slide5.find(".slide_text3").attr("class", "slide_text3 "+$slide5.find(".slide_text3").attr("data-anim"));
			$slide5.find(".slide_price").attr("class", "slide_price "+$slide5.find(".slide_price").attr("data-anim"));
			setTimeout(function(){
				$slide5.find(".slide_text1").addClass("anim").addClass("bounceIn");
				setTimeout(function(){
					$slide5.find(".slide_text2").addClass("anim").addClass("bounceInLeft");
					setTimeout(function(){
						$slide5.find(".slide_price").addClass("anim").addClass("lightSpeedIn");
						setTimeout(function(){
							$slide5.find(".slide_text3").addClass("anim").addClass("bounceIn");
							setTimeout(function(){
								var $next = $(".slide5").next();
								setTimeout(function(){
									$next.css("left", "960px");
									$(".slide5").animate({"left": "-960px"}, 500, "easeOutQuint");
									$next.animate({"left": "0px"}, 500, "easeOutQuint");
								}, 100);
								setTimeout(function(){
									if ($next.attr("class").match(/slide1/)){
										slide1_anim("next");
									}
								}, 200);
							}, 5600);
						}, 500);					
					}, 800);
				}, 500);
			}, 0);
		}
	}	

});